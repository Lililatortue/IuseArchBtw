CREATE TABLE IF NOT EXISTS  CalUser (
	id INTEGER NOT NULL,
	name TEXT NOT NULL,
	email TEXT NOT NULL,
	password TEXT NOT NULL,
	salt TEXT NOT NULL,
	PRIMARY KEY(id)
);

CREATE TABLE IF NOT EXISTS  CalGroup (
	id INTEGER NOT NULL,
	owner_id INTEGER NOT NULL,
	PRIMARY KEY(id),
	FOREIGN KEY(owner_id) 
	  REFERENCES CalUser(id)
	  ON DELETE CASCADE
	  ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS  GroupMember (
	group_id INTEGER NOT NULL,
	user_id INTEGER NOT NULL,
	PRIMARY KEY(group_id, user_id),
	FOREIGN KEY(group_id) 
	  REFERENCES CalGroup(id)
	  ON DELETE CASCADE
	  ON UPDATE CASCADE,
	FOREIGN KEY(user_id) 
	  REFERENCES CalUser(id)
	  ON DELETE CASCADE
	  ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS  Friend (
	user_id INTEGER NOT NULL,
	friend_id INTEGER NOT NULL,
	PRIMARY KEY(user_id, friend_id),
	FOREIGN KEY(user_id) 
	  REFERENCES CalUser(id)
	  ON DELETE CASCADE
	  ON UPDATE CASCADE,
	FOREIGN KEY(friend_id) 
	  REFERENCES CalUser(id)
	  ON DELETE CASCADE
	  ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS Availability (
	user_id INTEGER NOT NULL,
	creneau ENUM(
	  '9H00-10H00', '10H00-11H00', '11H00-12H00', '12H00-13H00', '13H00-14H00',
	  '14H00-15H00', '15H00-16H00', '16H00-17H00', '17H00-18H00', '18H00-19H00',
	  'ALL-DAY'
	) NOT NULL,
	at_date DATE NOT NULL,
	PRIMARY KEY(user_id, creneau, at_date),
	FOREIGN KEY(user_id) 
	  REFERENCES CalUser(id)
	  ON DELETE CASCADE
	  ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS  Appointment (
	id INTEGER NOT NULL,
	user_id INTEGER NOT NULL,
	group_id INTEGER NOT NULL,
	creneau_start ENUM(
	  '9H00-10H00', '10H00-11H00', '11H00-12H00', '12H00-13H00', '13H00-14H00',
	  '14H00-15H00', '15H00-16H00', '16H00-17H00', '17H00-18H00', '18H00-19H00',
	  'ALL-DAY'
	) NOT NULL,
	creneau_end ENUM(
	  '9H00-10H00', '10H00-11H00', '11H00-12H00', '12H00-13H00', '13H00-14H00',
	  '14H00-15H00', '15H00-16H00', '16H00-17H00', '17H00-18H00', '18H00-19H00'
	),
	at_date DATE NOT NULL,
	PRIMARY KEY(id),
	FOREIGN KEY(user_id) 
	  REFERENCES CalUser(id)
	  ON DELETE CASCADE
	  ON UPDATE CASCADE,
	FOREIGN KEY(group_id) 
	  REFERENCES CalGroup(id)
	  ON DELETE CASCADE
	  ON UPDATE CASCADE,

	CONSTRAINT creneau_end_chk 
	  CHECK (creneau_end IS NOT NULL OR creneau_start = 'ALL-DAY')
);
